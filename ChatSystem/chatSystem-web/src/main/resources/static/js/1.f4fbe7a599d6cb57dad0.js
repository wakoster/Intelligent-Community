webpackJsonp([1,2],{"2ddZ":function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var a=e("mvHQ"),n=e.n(a);var i={components:{errorMessage:e("AVWw").a},name:"Chat",data:function(){return{selfUserId:{id:1},info:{userId:null,userName:null,userImg:null,chattingRecordPage:0},talkTag:{},sessionMsg:{},userInformation:{code:null,msg:null,total:null,data:{userImg:null,name:null,id:null,phoneNumber:null,mailbox:null,address:null,department:null}}}},mounted:function(){this.info.userId=this.$route.query.userId,this.getSelfUserInfo(),this.getChatList()},methods:{getSelfUserInfo:function(){var t=this;this.$axios.get("/user/getSelfUserInfo").then(function(s){var e=s.data;0===e.code?t.selfUserInfo=e.data:t.showErrorMessage(e.msg)}).catch(function(s){t.showErrorMessage(s)})},clickTalkBox:function(t,s){this.sessionMsg={},this.info.userId=s.userId,this.info.userName=s.userName,this.info.userImg=s.userImg,this.info.chattingRecordPage=0,null!==document.querySelector(".more.hidden")&&document.querySelector(".more").classList.add("hidden"),document.querySelectorAll(".talkbox.active").forEach(function(t){return t.classList.remove("active")}),t.currentTarget.className+=" active",this.moreChattingRecord(!1)},moreChattingRecord:function(t){var s=this,e=null,a=null;t&&(e=document.querySelector(".session-window").scrollHeight,a=document.querySelector(".session-window").scrollTop),this.$axios.post("/chat/getChattingRecord",{id:this.selfUserInfo.id,chatUserId:this.info.userId,page:this.info.chattingRecordPage}).then(function(t){var e=t.data;0===e.code?("{}"===n()(s.sessionMsg)?s.sessionMsg=e:s.sessionMsg.data=e.data.concat(s.sessionMsg.data),s.info.chattingRecordPage+=1,e.data.length<20&&null!==document.querySelector(".more")?document.querySelector(".more").classList.add("hidden"):20===e.data.length&&null!==document.querySelector(".more.hidden")&&document.querySelector(".more.hidden").classList.remove("hidden")):s.showErrorMessage(e.msg)}).catch(function(t){s.showErrorMessage(t)}).finally(function(){t&&(document.querySelector(".session-window").scrollTop=document.querySelector(".session-window").scrollHeight-e+a)})},chattingScrollToBottom:function(){var t=this;this.$nextTick(function(){var s=t.$el.querySelector(".session-window");s.scrollTop=s.scrollHeight})},getChatList:function(){var t=this;this.$axios.post("/chat/getChatList",{phoneNumber:this.$cookies.get("cookie_userPhoneNumber"),userId:this.info.userId}).then(function(s){var e=s.data;if(0===e.code){if(t.talkTag=e,null!==t.info.userId)for(var a=0;a<t.talkTag.data.length;a++)if(t.talkTag.data[a].userId.toString()===t.info.userId){t.sessionMsg={},t.info.userId=t.talkTag.data[a].userId,t.info.userName=t.talkTag.data[a].userName,t.info.userImg=t.talkTag.data[a].userImg,t.info.chattingRecordPage=0,t.talkTag.data[a].unreadMessage=0,t.moreChattingRecord(!1);break}}else t.showErrorMessage(e.msg)}).catch(function(s){t.showErrorMessage(s)})},getUserInfo:function(){var t=this;this.$axios.post("/user/getUserInfo",{id:this.info.userId}).then(function(s){var e=s.data;0===e.code?t.userInformation=e:t.showErrorMessage(e.msg)}).catch(function(s){t.showErrorMessage(s)})},formatDate:function(t){return null===t?"":function(t,s){if(!t)return"";t=t&&13!==t.length?parseInt(t*Math.pow(10,13-t.length)):parseInt(t);var e=new Date(t),a={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};for(var n in/(y+)/.test(s)&&(s=s.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))),a)new RegExp("("+n+")").test(s)&&(s=s.replace(RegExp.$1,1===RegExp.$1.length?a[n]:("00"+a[n]).substr((""+a[n]).length)));return s}(t.toString(),"yyyy-MM-dd hh:mm")},showErrorMessage:function(t){this.$refs.errorMessage.setErrorMessage(t)}}},r={render:function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"chat"},[e("div",{staticClass:"talkList"},[t._m(0),t._v(" "),e("div",{staticClass:"talkTag"},t._l(t.talkTag.data,function(s){return e("div",{key:s.id},[e("div",{staticClass:"talkbox",class:{active:s.userId==t.info.userId},on:{click:function(e){s.unreadMessage=0,t.clickTalkBox(e,s)}}},[e("div",{staticClass:"talkcircle"},[e("img",{staticClass:"img",attrs:{src:s.userImg}})]),t._v(" "),s.unreadMessage>0?e("div",{staticClass:"unreadNumber"},[t._v(t._s(s.unreadMessage>99?"···":s.unreadMessage))]):t._e(),t._v(" "),e("label",{staticClass:"userName"},[t._v(t._s(s.userName))]),t._v(" "),e("label",{staticClass:"talkInfo"},[t._v(t._s(s.talkInfo))]),t._v(" "),e("label",{staticClass:"talkTime"},[t._v(t._s(t.formatDate(s.talkTime)))])])])}),0)]),t._v(" "),e("div",{staticClass:"session"},[void 0!==t.info.userId?e("div",{staticClass:"session-box"},[e("label",{staticClass:"userName"},[t._v(t._s(t.info.userName))]),t._v(" "),e("div",{staticClass:"session-window"},[e("div",{staticClass:"more hidden",on:{click:function(s){return t.moreChattingRecord(!0)}}},[t._v("查看更多消息")]),t._v(" "),t._l(t.sessionMsg.data,function(s){return e("div",{key:s.userId},[e("div",{staticClass:"session-msg",class:{receiver:s.senderUserInfo===t.info.userId}},[s.senderUserInfo!==t.info.userId?e("img",{staticClass:"userImg",attrs:{src:t.info.userImg}}):t._e(),t._v(" "),s.senderUserInfo===t.info.userId?e("img",{staticClass:"userImg",attrs:{src:t.selfUserInfo.userImg}}):t._e(),t._v(" "),e("div",{staticClass:"msg-detail"},[e("div",{staticClass:"msg-title"},[s.senderUserInfo!==t.info.userId?e("label",{staticClass:"user-name"},[t._v(t._s(t.info.userName))]):t._e(),t._v(" "),s.senderUserInfo===t.info.userId?e("label",{staticClass:"user-name"},[t._v("我")]):t._e(),t._v(" "),e("label",{staticClass:"msg-time"},[t._v(t._s(t.formatDate(s.createTime)))])]),t._v(" "),e("div",{staticClass:"msg-conttent"},[t._v(t._s(s.chattingRecord))])])])])})],2),t._v(" "),void 0!==t.info.userId?e("div",{staticClass:"chatting"},[e("textarea",{staticClass:"info",attrs:{name:"talk",id:"talk",placeholder:"请输入内容"}}),t._v(" "),t._m(1)]):t._e(),t._v(" "),void 0!==t.info.userId?e("div",{staticClass:"userInfo",attrs:{tabindex:"0",onblur:"document.querySelector('.userInfo .pop.active') !== null?document.querySelector('.userInfo .pop.active').classList.toggle('active'):'无事发生'"}},[e("span",{staticClass:"iconfont",attrs:{onclick:"document.querySelector('.userInfo .pop').classList.toggle('active')"},on:{click:t.getUserInfo}},[t._v("")]),t._v(" "),e("div",{staticClass:"pop"},[e("img",{staticClass:"userImg",attrs:{src:t.userInformation.data.userImg}}),t._v(" "),e("div",{staticClass:"userName"},[t._v(t._s(t.userInformation.data.name))]),t._v(" "),e("div",{staticClass:"userId"},[t._v("编 号: "+t._s(t.userInformation.data.id))]),t._v(" "),e("div",{staticClass:"line"}),t._v(" "),e("div",{staticClass:"userPhone"},[t._v("电话号码: "+t._s(t.userInformation.data.phoneNumber))]),t._v(" "),e("div",{staticClass:"userPhone"},[t._v("电子邮件: "+t._s(t.userInformation.data.mailbox))]),t._v(" "),e("div",{staticClass:"userAddres"},[t._v("地  区: "+t._s(t.userInformation.data.address))]),t._v(" "),e("div",{staticClass:"userDepartment"},[t._v("部  门: "+t._s(t.userInformation.data.department))])])]):t._e()]):t._e()]),t._v(" "),e("error-message",{ref:"errorMessage"})],1)},staticRenderFns:[function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"search"},[s("div",{staticClass:"search-iconfont"},[s("span",{staticClass:"iconfont",attrs:{onclick:"document.querySelector('.search').classList.toggle('active')"}},[this._v("")])]),this._v(" "),s("div",{staticClass:"search-input"},[s("input",{attrs:{type:"text",placeholder:"Search",id:"search-input"}})]),this._v(" "),s("div",{staticClass:"clear-iconfont"},[s("span",{staticClass:"iconfont",attrs:{onclick:"document.getElementById('search-input').value = ''"}},[this._v("")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"send"},[s("button",{staticClass:"button",attrs:{type:"submit"}},[this._v("发送")])])}]};var o=e("VU/8")(i,r,!1,function(t){e("O8u1")},"data-v-54041bca",null);s.default=o.exports},FeBl:function(t,s){var e=t.exports={version:"2.6.12"};"number"==typeof __e&&(__e=e)},O8u1:function(t,s){},RDcg:function(t,s){},dAjm:function(t,s,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var a={components:{Chat:e("2ddZ").default},name:"homePage"},n={render:function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"homePage"},[e("router-view"),t._v(" "),e("div",{staticClass:"navigationBar"},[e("ul",[e("li",{staticClass:"navigation-list",class:{active:"/chatSystem/chat"==this.$route.path}},[e("router-link",{staticClass:"router-link",attrs:{to:"/chatSystem/chat"}},[e("span",{staticClass:"iconfont"},[t._v("")]),t._v(" "),e("span",{staticClass:"iconfont-text"},[t._v("聊天")])])],1),t._v(" "),e("li",{staticClass:"navigation-list",class:{active:"/chatSystem/contacts"==this.$route.path}},[e("router-link",{staticClass:"router-link",attrs:{to:"/chatSystem/contacts"}},[e("span",{staticClass:"iconfont"},[t._v("")]),t._v(" "),e("span",{staticClass:"iconfont-text"},[t._v("通讯录")])])],1),t._v(" "),e("li",{staticClass:"navigation-list",class:{active:"/chatSystem/userInfo"==this.$route.path}},[e("router-link",{staticClass:"router-link",attrs:{to:"/chatSystem/userInfo"}},[e("span",{staticClass:"iconfont"},[t._v("")]),t._v(" "),e("span",{staticClass:"iconfont-text"},[t._v("个人信息")])])],1)])])],1)},staticRenderFns:[]};var i=e("VU/8")(a,n,!1,function(t){e("RDcg")},"data-v-45bbaad0",null);s.default=i.exports},mvHQ:function(t,s,e){t.exports={default:e("qkKv"),__esModule:!0}},qkKv:function(t,s,e){var a=e("FeBl"),n=a.JSON||(a.JSON={stringify:JSON.stringify});t.exports=function(t){return n.stringify.apply(n,arguments)}}});
//# sourceMappingURL=1.f4fbe7a599d6cb57dad0.js.map